1. **HandleEventsCommand**

- **run** – при выполнении не возникает исключений. Можем написать unit-тест с помощью тестовых двойников.
    
- **shouldEventBeRan** – если передан EventDto, который совпадает по времени с текущим временем, должен вернуть true. Уже написали unit-тест.
    
- **shouldEventBeRan** – если передан EventDto, который не совпадает по времени с текущим временем, должен вернуть false. Уже написали unit-тест.
    
1. **HandleEventsDaemonCommand пропустим, т.к. это демон и его мы не можем протестировать в phpunit**

2. **SaveEventCommand**

- **run** – если переданы значения, то они сохраняются в БД. Не тестируем, т.к. присутствуют побочные эффекты в виде обращения к БД. Уже написали unit-тест.
    
- **run** – если значения не переданы, то возвращается текст справки. Можем написать unit-тест с помощью тестовых двойников.
    
- **getGetoptOptionValues** – не тестируем, т.к. мы не можем передать getopt опции из phpunit.
    
- **isNeedHelp** – если переданы параметры name, text, receiver и cron и не переданы параметры -h или --help возвращает false. Уже написали unit-тест.
    
- **showHelp** – возвращает текст, в котором присутствует слово “СПРАВКА”. Уже написали unit тест.
    
- **getCronValues** – все * преобразуются в null. Уже написали unit-тест.
    
- **getCronValues** – все значения кроме * преобразуются в строку. Уже написали unit-тест.
    
- **getCronValues** – размер возвращаемого массива равен количеству пробелов во входящей строке +1. Уже написали unit-тест.
    
- **saveEvent** – можем написать unit тест с помощью тестовых двойников.
    
1. **TgMessagesCommand**

- **run** –  можем написать unit тест с помощью тестовых двойников:
    
- При запуске вызывает getMessages у экземпляра TelegramApi с ожидаемым offset.
- В зависимости от номера сообщения, возвращает определенный ответ.
- Вызывает sendMessage у экземпляра TelegramApi для отправки ответа.
    
1. **createEventAndReturnMessage** – можем написать unit-тест с помощью тестовых двойников:
- Корректно сохраняет переданные значения.
- Возвращает ожидаемое сообщение.
- Если произошла ошибка в cron строке возвращает ответ, говорящий об этом

- **getCronValues** – тестируем аналогично getCronValues в SaveEventCommand. Уже написали unit-тест.
    
- **saveEvent** –  можем написать unit-тест с помощью тестовых двойников.
    
1. **EventSender**

- **sendMessage** – можем написать unit-тест с помощью тестовых двойников.
    
1. **TelegramApiImpl**

- **getMessages** – отсутствуют ошибки при обработке данных из телеграм. Не тестируем, потому что, по сути, вызываем обращение к телеграм, что переводит наш тест в функциональный. Это делает наш тест функциональным. Как этого избежать поговорим на следующем уроке.
    
- **getMessages** – возвращает массив формата
    
    [    
    'offset' => $offset,
    
    'result' => $result,
    
    ]
    

Не тестируем, потому что по сути вызываем обращение к телеграм, что переводит наш тест в функциональный.

- **sendMessage** – не содержит ошибок при общении с Телеграм. Не тестируем, потому что, по сути, вызываем обращение к телеграм, что переводит наш тест в функциональный.

**По итогу у нас получаются следующие контракты для Unit-тестирования:**

1. HandleEventsCommand::run – при выполнении не возникает исключений.
2. SaveEventCommand::run – если значения не переданы, то возвращается текст справки.
3. SaveEventCommand::saveEvent – сохраняет переданные значения.
4. TgMessagesCommand::run – при запуске вызывает getMessages у экземпляра TelegramApi с ожидаемым offset.
5. TgMessagesCommand::run – в зависимости от номера сообщения возвращает определенный ответ.
6. TgMessagesCommand::run – вызывает sendMessage у экземпляра TelegramApi для отправки ответа.
7. TgMessagesCommand::createEventAndReturnMessage – корректно сохраняет переданные значения.
8. TgMessagesCommand::createEventAndReturnMessage – возвращает ожидаемое сообщение.
9. TgMessagesCommand::createEventAndReturnMessage – если произошла ошибка в cron строке возвращает ответ, говорящий об этом
10. TgMessagesCommand::saveEvent – сохраняет переданные значения.
11. EventSender::sendMessage – вызывает метод отправки сообщения в объекте TelegramApi.